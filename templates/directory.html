{% extends "layout.html" %}
{% block content %}

<script>
$(function () {
	// Cache links list.
	var links = {};
	$('#person-list div').each(function () {
		links[$('h3', this).text().toLowerCase()] = this;
	});

	// Filter lists based on a keywords array.
	function filterList(keywords) {
		// If there are no keywords, show all links.
		if (!keywords.length) {
			$.each(links, function (title, link) {
				$(link).show()
			});
		} else {
			$.each(links, function (title, link) {
				$(link).removeClass('first')
				$.each(keywords, function (_, keyword) {
					if (!title.match(keyword)) {
						$(link).hide()
					} else {
						$(link).show()
					}
				})
			});
		}
	}

	// Keyup filter.
	$('#filter-input').keyup(function () {
		// Filter keywords
		var keywords = $.grep($('#filter-input').val().toLowerCase().split(/\s+/), $.trim);
		filterList(keywords);
	}).focus();
	// Filter initially so we update shortcut link.
	filterList([]);
})
</script>

<style>
#person-list { margin-top: 20px; overflow: auto; padding-bottom: 10px; }
#person-list div { overflow: auto; padding-bottom: 15px; box-shadow: #666 1px 1px 1px; margin-bottom: 15px; margin-right: 15px; width: 375px; float: left; background: #eee; padding: 10px 15px;}
#person-list h3 { margin: 0; font-size: 20px;}
#person-list p { }

#header .header-search { padding: 5px 0 0 5px; vertical-align: baseline; }
</style>

<div id="header" class="form-search row">
	<h1>Directory (Beta)</h1>
	<div class="input-prepend header-search">
    <span class="add-on">
        <i class="icon-search"></i>
    </span>
	<input type="search" class="span3" placeholder="Filter names..." name="search" id="filter-input">
</div>

	<div id="header-controls">

<a href="#updateprofile" role="button" class="btn btn-info" data-toggle="modal">Update your profile</a>
<div class="modal hide fade" id="updateprofile">
	<div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
    <h3>Update Your Profile</h3>
  </div>
  <div class="modal-body">
    <form method="post" action="/api/me">
    Avatar URL: <input name="avatar" value="{{ user.avatar }}"><br>
		Nickname: <input name="nickname" value="{{ user.nickname }}"><br>
		Location/Room: <input name="room" value="{{ user.room }}"><br>
		Year: <input name="year" value="{{ user.year }}"><br>
		Phone #: <input name="phone" value="{{ user.phone }}"><br>
		<button>Submit</button>
		</form>
  </div>
	</div>
</div>
</div> 

<div class="container-fluid">
 <div id="person-list"> 

{% for person in people %}
<div>
	<img style="float: left; width: 100px; height: 100px; margin-right: 10px;" src="{{ person.avatar }}">
	<h3>{{ person.nickname or person.name }} {% if person.year %}({{ person.year }}){% endif %}</h3>
	<p>
		{% if person.room %}<b>Location:</b> {{ person.room }}<br>{% endif %}
		{% if person.phone %}<b>Phone:</b> <a href="tel:{{ person.phone }}">{{ person.phone }}</a><br>{% endif %}
		<a href="mailto:{{ person.email }}">{{ person.email }}</a>
	</p>
</div>
{% endfor %}
</div>
</div>

{% endblock %}